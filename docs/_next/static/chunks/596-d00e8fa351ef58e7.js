"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[596],{5596:function(t,e,n){n.d(e,{Z:function(){return tt}});var r,i=n(9447),o=n(7637),s=n(1527),a=n(959),c=function(t){var e=t.width,n=t.height,r=t.style;return(0,s.jsx)("svg",{width:e,height:n,style:r,viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M1664 192v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45zm-896 0v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45z"})})},$=function(t){var e=t.width,n=t.height,r=t.style;return(0,s.jsx)("svg",{width:e,height:n,style:r,viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M1576 927l-1328 738q-23 13-39.5 3t-16.5-36v-1472q0-26 16.5-36t39.5 3l1328 738q23 13 23 31t-23 31z"})})},l=function(t){var e=t.width,n=t.height,r=t.style;return(0,s.jsx)("svg",{width:e,height:n,style:r,viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M832 352v1088q0 26-19 45t-45 19-45-19l-333-333h-262q-26 0-45-19t-19-45v-384q0-26 19-45t45-19h262l333-333q19-19 45-19t45 19 19 45zm384 544q0 76-42.5 141.5t-112.5 93.5q-10 5-25 5-26 0-45-18.5t-19-45.5q0-21 12-35.5t29-25 34-23 29-36 12-56.5-12-56.5-29-36-34-23-29-25-12-35.5q0-27 19-45.5t45-18.5q15 0 25 5 70 27 112.5 93t42.5 142zm256 0q0 153-85 282.5t-225 188.5q-13 5-25 5-27 0-46-19t-19-45q0-39 39-59 56-29 76-44 74-54 115.5-135.5t41.5-173.5-41.5-173.5-115.5-135.5q-20-15-76-44-39-20-39-59 0-26 19-45t45-19q13 0 26 5 140 59 225 188.5t85 282.5zm256 0q0 230-127 422.5t-338 283.5q-13 5-26 5-26 0-45-19t-19-45q0-36 39-59 7-4 22.5-10.5t22.5-10.5q46-25 82-51 123-91 192-227t69-289-69-289-192-227q-36-26-82-51-7-4-22.5-10.5t-22.5-10.5q-39-23-39-59 0-26 19-45t45-19q13 0 26 5 211 91 338 283.5t127 422.5z"})})},h=function(t){var e=t.width,n=t.height,r=t.style;return(0,s.jsx)("svg",{width:e,height:n,style:r,viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M1280 352v1088q0 26-19 45t-45 19-45-19l-333-333h-262q-26 0-45-19t-19-45v-384q0-26 19-45t45-19h262l333-333q19-19 45-19t45 19 19 45z"})})},u=function(t){return(0,s.jsx)("svg",{width:t.width,height:t.height,style:t.style,onClick:t.onClick,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",children:(0,s.jsx)("path",{fill:t.isEnable?"black":"gray",d:"M256 64c0-35.3-28.7-64-64-64s-64 28.7-64 64s28.7 64 64 64s64-28.7 64-64zM152.9 169.3c-23.7-8.4-44.5-24.3-58.8-45.8L74.6 94.2C64.8 79.5 45 75.6 30.2 85.4s-18.7 29.7-8.9 44.4L40.9 159c18.1 27.1 42.8 48.4 71.1 62.4V480c0 17.7 14.3 32 32 32s32-14.3 32-32V384h32v96c0 17.7 14.3 32 32 32s32-14.3 32-32V221.6c29.1-14.2 54.4-36.2 72.7-64.2l18.2-27.9c9.6-14.8 5.4-34.6-9.4-44.3s-34.6-5.5-44.3 9.4L291 122.4c-21.8 33.4-58.9 53.6-98.8 53.6c-12.6 0-24.9-2-36.6-5.8c-.9-.3-1.8-.7-2.7-.9z"})})},_=function(t){return(0,s.jsx)("svg",{width:t.width,height:t.height,style:t.style,xmlns:"http://www.w3.org/2000/svg",onClick:t.onClick,viewBox:"0 0 512 512",children:(0,s.jsx)("path",{fill:t.isEnable?"black":"gray",d:"M128 64c0-17.7 14.3-32 32-32H320c17.7 0 32 14.3 32 32V416h96V256c0-17.7 14.3-32 32-32H608c17.7 0 32 14.3 32 32s-14.3 32-32 32H512V448c0 17.7-14.3 32-32 32H320c-17.7 0-32-14.3-32-32V96H192V256c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h96V64z"})})},f=function(t){return(0,s.jsx)("div",{onClick:t.onPlayPause,style:t.styles.button,children:t.isPlaying?(0,s.jsx)(c,{style:t.styles.buttonIcon}):(0,s.jsx)($,{style:t.styles.buttonIcon})})},v=function(t){var e=function(t){if(!t)return"00:00:00";var e=Math.floor(t/3600),n=Math.floor(t%3600/60),r=Math.floor(t%3600%60);return"".concat(e<10?"0"+e:e,":").concat(n<10?"0"+n:n,":").concat(r<10?"0"+r:r)};return(0,s.jsxs)("div",{style:t.styles.time,children:[e(t.currentTime),"/",e(t.duration)]})};function d(t){var e=function(e){if(r.current){var n,i=e.nativeEvent.offsetX,o=(620*(i/r.current.offsetWidth)-10)/600*t.duration;t.onSeek(o)}},n=t.duration||1,r=(0,a.useRef)(null),i=t.currentTime?t.currentTime/n:0,o=t.annotSpans.map(function(t){var e=t.offset/n*600,r=(t.offset+t.span)/n*600;return(0,s.jsx)("rect",{x:e,y:"0",rx:"1",ry:"1",width:Math.max(r-e,5)||0,height:"10",style:{fill:"url(#span-gradient)"},children:(0,s.jsx)("title",{children:t.annotation})},"".concat(e,"-").concat(r))});return(0,s.jsx)("div",{ref:r,onClick:e,style:{display:"block",width:"100%",height:"3vh",textAlign:"center",background:"linear-gradient(0deg, #333333 0%, #c2c2c2 100%)"},children:(0,s.jsxs)("svg",{width:"100%",height:"100%",viewBox:"-10 -5 620 20",preserveAspectRatio:"none",fill:"none",style:{marginTop:"-7px"},xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsxs)("linearGradient",{id:"timeline-gradient",x1:"0",y1:"0",x2:"0",y2:"10",gradientUnits:"userSpaceOnUse",children:[(0,s.jsx)("stop",{offset:"0",stopColor:"#333333"}),(0,s.jsx)("stop",{offset:"1",stopColor:"#c2c2c2"})]}),(0,s.jsxs)("linearGradient",{id:"span-gradient",x1:"0",y1:"0",x2:"0",y2:"10",gradientUnits:"userSpaceOnUse",children:[(0,s.jsx)("stop",{offset:"0",stopColor:"#EECC33FF"}),(0,s.jsx)("stop",{offset:"1",stopColor:"#FFDD33FF"})]}),(0,s.jsx)("rect",{x:"0",y:"0",width:600,height:"10",rx:"5",ry:"5",style:{strokeWidth:"0px",fill:"url(#timeline-gradient)"}}),o,(0,s.jsx)("rect",{x:600*i,y:"0",width:"1",height:"10",style:{fill:"#EE0000"}})]})})}var p=function(t){return(0,s.jsx)("div",{onClick:t.onToggleMute,style:t.styles.button,children:t.isMuted?(0,s.jsx)(l,{style:t.styles.buttonIcon}):(0,s.jsx)(h,{style:t.styles.buttonIcon})})},g=n(4502);function y(t){return(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[(0,s.jsx)(g.Z,{href:"#",color:"#006",onClick:function(){return t.onWinSizeChanged(1)},children:"1s"}),(0,s.jsx)(g.Z,{href:"#",color:"#006",onClick:function(){return t.onWinSizeChanged(3)},children:"3s"}),(0,s.jsx)(g.Z,{href:"#",color:"#006",onClick:function(){return t.onWinSizeChanged(5)},children:"5s"}),(0,s.jsx)(g.Z,{href:"#",color:"#006",onClick:function(){return t.onWinSizeChanged(10)},children:"10s"})]})}function w(t){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_,{isEnable:t.toShowWaveform,onClick:t.onWaveformToggled,style:t.styles.buttonIcon}),(0,s.jsx)(u,{isEnable:t.toShowPosture,onClick:t.onPostureToggled,style:t.styles.buttonIcon})]})}var x=function(t){var e=t.videoState,n=t.videoCtrl;return(0,s.jsxs)("div",{children:[(0,s.jsx)(d,{currentTime:e.currentTime,duration:e.duration,onSeek:function(t){return n.seek(t)},annotSpans:t.annotSpans}),(0,s.jsxs)("div",{style:t.styles.barContainer,children:[(0,s.jsx)(f,{isPlaying:e.isPlaying,styles:t.styles,onPlayPause:function(){return n.playPause()}}),(0,s.jsx)(v,{currentTime:e.currentTime,duration:e.duration,styles:t.styles}),(0,s.jsx)("div",{style:{flexGrow:1}}),(0,s.jsx)(w,{toShowPosture:t.videoState.toShowPosture,toShowWaveform:t.videoState.toShowWaveform,onPostureToggled:function(){return n.togglePosture()},onWaveformToggled:function(){return n.toggleWaveform()},styles:t.styles}),(0,s.jsx)(y,{onWinSizeChanged:t.onWinSizeChanged}),(0,s.jsx)(p,{isMuted:e.isMuted,styles:t.styles,onToggleMute:function(){return n.toggleMute()}})]})]})},S=n(7135),m=n(6091),P=n(9970),A=n(4254),T=n(9072);function k(t){if(!t)return 0;for(var e=t.split("."),n=.001*parseInt(e[1])||0,r=e[0].split(":").reverse(),i=0,o=0;o<r.length;o++)i+=parseInt(r[o])*Math.pow(60,o);return i+n}function E(t,e,n){var r=[];return e.forEach(function(i,o){var s=e[o],a=n[o],c=s;s!=a&&(c=s+(a-s)*t),r.push(c)}),r}function b(t,e,n){return e&&!n?e:!e&&n?n:e&&n?e.map(function(r,i){return E(t,e[i],n[i])}):null}function C(t,e,n){var r={face:null,pose:null,left_hand:null,right_hand:null};return e||n?e&&!n?e:!e&&n?n:(r.face=function(t,e,n){if(e&&!n)return e;if(!e&&n)return n;if(e&&n){var r={};return Object.keys(e).forEach(function(i){r[i]=Object.keys(e[i]).map(function(r,o){return E(t,e[i][o],n[i][o])})}),r}return null}(t,e.face,n.face),r.left_hand=b(t,e.left_hand,n.left_hand),r.right_hand=b(t,e.right_hand,n.right_hand),r.pose=b(t,e.pose,n.pose),r):null}function L(t,e){if(!t)return t;if(t.face){var n=!0,r=!1,i=void 0;try{for(var o,s=Object.entries(t.face)[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=(0,T.Z)(o.value,2);(a[0],a[1]).forEach(function(t){return t[0]=t[0]/2+e})}}catch(c){r=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}return t.pose&&t.pose.forEach(function(t){return t[0]=t[0]/2+e}),t.left_hand&&t.left_hand.forEach(function(t){return t[0]=t[0]/2+e}),t.right_hand&&t.right_hand.forEach(function(t){return t[0]=t[0]/2+e}),t}var W,M=2,j=function(){function t(){(0,m.Z)(this,t),this.videoName="",this.ocr_blocks=[],this.phones=[],this.wave=new Int8Array(0),this.vtt=[],this.speech_events=[],this.poses=[],this.posesTimestamps=[],this.isLoadingPosture=!1,this.baseURL="https://storage.googleapis.com/multimoco/selected"}var e=t.prototype;return e.setWaveWindow=function(t){M=t},e.setVideoName=function(t){this.videoName=t.replace(".mp4","")},e._reset_data=function(){this.ocr_blocks=[],this.phones=[],this.wave=new Int8Array(0),this.vtt=[],this.speech_events=[],this.poses=[]},e.loadData=function(){var t=this;this._reset_data(),Promise.allSettled([this.getOCR(),this.getPhones(),this.getVTT(),this.getWave(),this.getSpeechEvents()]).then(function(e){var n=e[0];"fulfilled"==n.status&&(t.ocr_blocks=n.value);var r=e[1];"fulfilled"==r.status&&(t.phones=r.value);var i=e[2];"fulfilled"==i.status&&(t.vtt=i.value);var o=e[3];"fulfilled"==o.status&&(t.wave=o.value);var s=e[4];"fulfilled"==s.status&&(t.speech_events=s.value)})},e.getData=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this,r={},i=t-M/2,o=t+M/2;if(this.ocr_blocks.length>0){var s=1e3*t,a=this.ocr_blocks.filter(function(t){return t.offset<=s&&s<t.offset+t.span});r.ocr_blocks=a}else r.ocr_blocks=[];if(this.phones.length>0){var c=this.phones.filter(function(t){return i<=t[1]&&t[2]<o});r.phones=c}else r.phones=[];if(this.vtt.length>0){var $=this.vtt.filter(function(e){return e.start<=t&&t<e.end});r.vtt=$}else r.vtt=[];if(this.wave.length>1e3*o){var l=this.wave.slice(1e3*i,1e3*o);r.wave=l,r.wave_span=[i,o],r.wave_fr=1e3}else r.wave=new Int8Array(0),r.wave_span=[0,0],r.wave_fr=1e3;if(this.speech_events.length>0){var h=this.speech_events.filter(function(t){return t[0]<i&&i<t[1]||t[0]<o&&o<t[1]||i<t[0]&&t[1]<o});r.speech_events=h}else r.speech_events=[];if(e&&!this.isLoadingPosture&&0==this.poses.length&&(this.isLoadingPosture=!0,this.getPose().then(function(t){n.poses=t,n.posesTimestamps=n.poses.map(function(t){return t.offset}),n.isLoadingPosture=!1})),this.poses.length>0){var u=1e3*t,_=this.posesTimestamps.findIndex(function(t){return t>u})||1,f=this.poses[Math.max(_-1,0)],v=this.poses[_],d=0;f&&v&&(d=(u-f.offset)/(v.offset-f.offset));var p=[C(d,f&&f.left,v&&v.left),C(d,f&&f.right,v&&v.right),];r.poses=p.filter(function(t){return t})}else r.poses=[];return r},e.getOCR=function(){var t=this;return(0,S.Z)(function(){var e,n,r;return(0,A.__generator)(this,function(i){switch(i.label){case 0:return[4,fetch(t.baseURL+"/ocr_blocks/".concat(t.videoName,".ocr.blocks.json"))];case 1:if(200!=(e=i.sent()).status)return[3,3];return[4,e.text()];case 2:return[2,r=JSON.parse(n=i.sent())];case 3:return[2,[]];case 4:return[2]}})})()},e.getPhones=function(){var t=this;return(0,S.Z)(function(){var e,n,r;return(0,A.__generator)(this,function(i){switch(i.label){case 0:return[4,fetch(t.baseURL+"/phone_cosp/".concat(t.videoName,".phones.json"))];case 1:return[4,(e=i.sent()).text()];case 2:return[2,r=(r=JSON.parse(n=i.sent())).map(function(t,e){return[e].concat((0,P.Z)(t))})]}})})()},e.getSpeechEvents=function(){var t=this;return(0,S.Z)(function(){var e,n,r;return(0,A.__generator)(this,function(i){switch(i.label){case 0:return[4,fetch(t.baseURL+"/speech_events/".concat(t.videoName,".speakers.json"))];case 1:return[4,(e=i.sent()).text()];case 2:return[2,r=JSON.parse(n=i.sent())]}})})()},e.getVTT=function(){var t=this;return(0,S.Z)(function(){var e,n,r;return(0,A.__generator)(this,function(i){switch(i.label){case 0:return[4,fetch(t.baseURL+"/vtt/".concat(t.videoName,".wav.vtt"))];case 1:return[4,(e=i.sent()).text()];case 2:return[2,r=function(t){var e=[],n=t.split("\n\n"),r=!0,i=!1,o=void 0;try{for(var s,a=n[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var c=s.value.split("\n"),$=c[0].match(/(\d+:)?\d+:\d+\.\d+/g),l=NaN,h=NaN;if((null==$?void 0:$.length)==2){l=k($[0]),h=k($[1]);var u=c.slice(1).join("\n");e.push({start:l,end:h,text:u})}}}catch(_){i=!0,o=_}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return e}(n=i.sent())]}})})()},e.getPose=function(){var t=this;return(0,S.Z)(function(){var e,n,r;return(0,A.__generator)(this,function(i){switch(i.label){case 0:return[4,fetch(t.baseURL+"/mp/".concat(t.videoName,".mp.json"))];case 1:if(200!=(e=i.sent()).status)return[3,3];return[4,e.text()];case 2:var o,s;return[2,r=(o=r=JSON.parse(n=i.sent()),0>(s=t.videoName).indexOf("clgvd")||(o.forEach(function(t){return L(t.left,0)}),o.forEach(function(t){return L(t.right,.5)})),o)];case 3:return[2,[]];case 4:return[2]}})})()},e.getWave=function(){var t=this;return(0,S.Z)(function(){var e,n,r,i;return(0,A.__generator)(this,function(o){switch(o.label){case 0:return[4,fetch(t.baseURL+"/pem/".concat(t.videoName,".wav.pem"))];case 1:return[4,(e=o.sent()).blob()];case 2:return n=o.sent(),(r=new FileReader).readAsArrayBuffer(n),[4,new Promise(function(t,e){r.onload=function(){if(r.result){var n=new Int8Array(r.result),i=n.reduce(function(t,e){return Math.min(t,e)},128),o=n.reduce(function(t,e){return Math.max(t,e)},-128);n.forEach(function(t,e){return n[e]=(t-i)/(o-i)*128-64}),t(n)}else e("Error reading wave data")}})];case 3:return[2,i=o.sent()]}})})()},t}();function H(t,e,n,r){var i=!1;if("eye"==n)i=r.some(function(e){return e.indexOf(t+"LOS")>=0});else if("hand"==n)i=r.some(function(n){return n.indexOf(t+e.toUpperCase()+"_PALM")>=0});else if("finger"==n){var o=r.some(function(n){return n.indexOf(t+e.toUpperCase()+"_THUMB")>=0}),s=r.some(function(n){return n.indexOf(t+e.toUpperCase()+"_INDEX")>=0});i=o||s}return i?({eye:"#66c2a5",hand:"#fc8d62",finger:"#fb8072"})[n]:"#AAA"}(W=r||(r={}))[W.LOS_DOWN=0]="LOS_DOWN",W[W.LOS_LEFT=1]="LOS_LEFT",W[W.LOS_RIGHT=2]="LOS_RIGHT",W[W.LEFT_PALM_IN=3]="LEFT_PALM_IN",W[W.LEFT_PALM_OUT=4]="LEFT_PALM_OUT",W[W.LEFT_PALM_UP=5]="LEFT_PALM_UP",W[W.LEFT_PALM_DOWN=6]="LEFT_PALM_DOWN",W[W.LEFT_PALM_MEDIAL=7]="LEFT_PALM_MEDIAL",W[W.LEFT_THUMB_UP=8]="LEFT_THUMB_UP",W[W.LEFT_INDEX_UP=9]="LEFT_INDEX_UP",W[W.RIGHT_PALM_IN=10]="RIGHT_PALM_IN",W[W.RIGHT_PALM_OUT=11]="RIGHT_PALM_OUT",W[W.RIGHT_PALM_UP=12]="RIGHT_PALM_UP",W[W.RIGHT_PALM_DOWN=13]="RIGHT_PALM_DOWN",W[W.RIGHT_PALM_MEDIAL=14]="RIGHT_PALM_MEDIAL",W[W.RIGHT_THUMB_UP=15]="RIGHT_THUMB_UP",W[W.RIGHT_INDEX_UP=16]="RIGHT_INDEX_UP";var R={SPEAKER_00:"#8dd3c7",SPEAKER_01:"#bebada",SPEAKER_02:"#fdcdac",OVERLAP:"#fb8072"},F={OVERLAP:0,SPEAKER_00:1,SPEAKER_01:2,SPEAKER_02:3},U="#FD9A",I=function(){function t(e){(0,m.Z)(this,t),this.ctx=null,this.annot={},this.cvsWidth=640,this.cvsHeight=360,this.wave_vh=50,this.toShowWave=!0,this.toShowOcr=!1,this.toShowPosture=!1,this.annot=e}var e=t.prototype;return e.setContext=function(t,e,n){this.ctx=t,this.cvsWidth=e,this.cvsHeight=n,this.wave_vh=50},e.setOptions=function(t){this.toShowWave=void 0===t.toShowWave||t.toShowWave,this.toShowOcr=void 0===t.toShowOcr||t.toShowOcr,this.toShowPosture=void 0===t.toShowPosture||t.toShowPosture},e.notifyWaveArea=function(t){this.annot.updateWaveArea(t)},e.notifySpanAreas=function(t){this.annot.updateSpanAreas(t)},e.paint=function(t,e){this.toShowOcr=this.toShowOcr&&t.ocr_blocks.length>0,this.toShowWave=this.toShowWave&&t.wave.length>0,this.toShowOcr&&this.overlay_ocr(t.ocr_blocks),this.toShowWave&&t.phones.length>0&&this.overlay_phones(t.phones,t.wave_fr,t.wave.length,t.wave_span),this.toShowWave&&this.overlay_wave(t.wave,t.wave_fr,t.wave_span,t.speech_events);var n=this.annot.annotSpans;this.toShowWave&&n&&this.overlay_spans(n,t.wave_fr,t.wave.length,t.wave_span),t.vtt.length>0&&this.overlay_vtt(t.vtt[0].text),this.toShowPosture&&t.poses.length>0&&(this.overlay_pose(t.poses[0],0),this.overlay_pose(t.poses[1],.5)),this.overlay_cosp(t.phones,t.wave_span)},e.overlay_text=function(t){this.ctx&&(this.ctx.fillStyle="white",this.ctx.font="50px serif",this.ctx.fillText(t,100,100))},e.overlay_ocr=function(t){if(this.ctx){var e=this.ctx,n=[],r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var c=s.value,$=(0,T.Z)(c.payload.box.coordinates[0],4),l=$[0],h=$[1],u=($[2],$[3]),_=[l[0]*this.cvsWidth/1280,h[1]*this.cvsHeight/720],f=(h[0]-l[0])*this.cvsWidth/1280,v=(u[1]-l[1])*this.cvsHeight/720,d={x:_[0],y:_[1],width:f,height:v};n.push([d,c])}}catch(p){i=!0,o=p}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}this.annot.updateOcrAreas(n.map(function(t){return t[0]}));var g=!0,y=!1,w=void 0;try{for(var x,S=n[Symbol.iterator]();!(g=(x=S.next()).done);g=!0){var m=(0,T.Z)(x.value,2),P=m[0],A=m[1];this.annot.cursorInBox(P)&&(this.annot.onOcrDetected(A),e.strokeStyle=this.annot.isPressed?"#F2B183":"#fd8d3c",e.lineWidth=2,e.strokeRect(P.x,P.y,P.width,P.height))}}catch(k){y=!0,w=k}finally{try{g||null==S.return||S.return()}finally{if(y)throw w}}}},e.overlay_vtt=function(t){if(this.ctx){this.ctx.font="20px serif",this.ctx.textAlign="center";var e=this.cvsWidth,n=0;this.toShowWave?n=this.cvsHeight-this.wave_vh-5:(n=this.cvsHeight-5,this.notifyWaveArea({x:0,y:0,width:e,height:0})),this.ctx.fillStyle="#333333AA",this.ctx.fillRect(0,n-20,e,25),this.ctx.fillStyle="white",this.ctx.fillText(t,e/2,n)}},e.overlay_wave=function(t,e,n,r){var i=function(n){var r=v.filter(function(t){var r=(0,T.Z)(t,3),i=r[0],o=r[1];r[2];var s=l+n/e;return i<s&&s<o}),i=R[r.length>0?r[0][2]:"other"]||"#FFFFFF",o=h(n),s=u(t[n]);f!=i&&(f=i,_.stroke(),_.lineWidth=1,_.strokeStyle=i,_.beginPath(),_.moveTo(o,s)),_.lineTo(o,s)},o=this;if(this.ctx){var s=t.length,a=this.cvsWidth,c=this.wave_vh,$=(0,T.Z)(n,2),l=$[0];$[1];var h=function(t){return~~(t/s*a)},u=function(t){return~~(t/196*c)+(o.cvsHeight-c/2)},_=this.ctx;_.lineWidth=1,_.strokeStyle="#FFFFFF",_.beginPath(),_.moveTo(h(0),u(0));for(var f="",v=r.sort(function(t,e){return(F[e[2]]||9)-(F[t[2]]||9)}),d=0;d<t.length;d++)i(d);_.stroke()}},e.overlay_phones=function(t,e,n,r){var i=this;if(this.ctx){var o=n,s=Math.max(~~(o/1500),1),a=(0,T.Z)(r,2),c=a[0];a[1];var $=this.cvsWidth,l=this.wave_vh,h=function(t){return~~(t/o*$)},u=function(t){return~~(-t/128*l/2)+(i.cvsHeight-l/2)},_=this.ctx;this.notifyWaveArea({x:0,y:this.cvsHeight-l,width:$,height:l}),_.fillStyle="#333A",_.fillRect(0,this.cvsHeight-l,$,l);for(var f=0;f<t.length;f++){var v=t[f],d=(0,T.Z)(v,4),p=d[0],g=d[1],y=d[2],w=d[3],x=(g-c)*e,S=(y-c)*e,m=h(x),P=h(S);if(f>0){var A={x:m,y:u(128),width:P-m,height:l};this.annot.cursorInBox(A)&&(this.annot.onPhoneDetected(v),_.fillStyle=this.annot.isPressed?U:"#DD9A",_.fillRect(A.x,A.y,A.width,A.height)),this.annot.isPhoneSelected(v)&&(_.fillStyle=U,_.fillRect(A.x,A.y,A.width,A.height)),o<6*e&&(_.beginPath(),_.strokeStyle="#FFF",_.lineWidth=1,_.moveTo(m,u(128)),_.lineTo(m,u(-128)),_.stroke())}if(~~p%s==0){this.ctx.font="14px serif",this.ctx.textAlign="center",_.fillStyle="#EEE";var k=w;k.startsWith("<")&&(k="_"),_.fillText(k,(m+P)/2,u(80))}}}},e.overlay_cosp=function(t,e){if(this.ctx){var n=this.ctx,i=this.cvsWidth,o=this.cvsHeight,s=(e[0]+e[1])/2,a=new Set;t.filter(function(t){return s-1<t[1]&&s>t[1]+.05}).forEach(function(t){t[4].map(function(t){return t>17?"SP2_"+r[t-17-1]:"SP1_"+r[t-1]}).forEach(function(t){return a.add(t)})}),function(t,e,n,r){t.fillStyle="#AAA";for(var i=Math.max(e/1e3*.05,.02),o=["SP1_","SP2_"],s=Array.from(r),a=0;a<o.length;a++){var c=o[a];t.translate((.93*a+.02)*e,.05*n),t.scale(i,i);var $=new Path2D("M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z");t.fillStyle=H(c,"","eye",s),t.fill($),t.resetTransform(),t.translate((.9*a+.045)*e,.13*n),t.scale(-i,i),t.fillStyle="#AAA";var l=new Path2D("M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V240c0 8.8-7.2 16-16 16s-16-7.2-16-16V64c0-17.7-14.3-32-32-32s-32 14.3-32 32V336c0 1.5 0 3.1 .1 4.6L67.6 283c-16-15.2-41.3-14.6-56.6 1.4s-14.6 41.3 1.4 56.6L124.8 448c43.1 41.1 100.4 64 160 64H304c97.2 0 176-78.8 176-176V128c0-17.7-14.3-32-32-32s-32 14.3-32 32V240c0 8.8-7.2 16-16 16s-16-7.2-16-16V64c0-17.7-14.3-32-32-32s-32 14.3-32 32V240c0 8.8-7.2 16-16 16s-16-7.2-16-16V32z");t.fillStyle=H(c,"right","hand",s),t.fill(l),t.resetTransform(),t.translate((.9*a+.05)*e,.13*n),t.scale(i,i),t.fillStyle=H(c,"left","hand",s),t.fill(l),t.resetTransform(),t.translate((.9*a+.02)*e,(.05+.16)*n),t.scale(i,i);var h=new Path2D("M313.4 32.9c26 5.2 42.9 30.5 37.7 56.5l-2.3 11.4c-5.3 26.7-15.1 52.1-28.8 75.2H464c26.5 0 48 21.5 48 48c0 25.3-19.5 46-44.3 47.9c7.7 8.5 12.3 19.8 12.3 32.1c0 23.4-16.8 42.9-38.9 47.1c4.4 7.2 6.9 15.8 6.9 24.9c0 21.3-13.9 39.4-33.1 45.6c.7 3.3 1.1 6.8 1.1 10.4c0 26.5-21.5 48-48 48H294.5c-19 0-37.5-5.6-53.3-16.1l-38.5-25.7C176 420.4 160 390.4 160 358.3V320 272 247.1c0-29.2 13.3-56.7 36-75l7.4-5.9c26.5-21.2 44.6-51 51.2-84.2l2.3-11.4c5.2-26 30.5-42.9 56.5-37.7zM32 192H96c17.7 0 32 14.3 32 32V448c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32V224c0-17.7 14.3-32 32-32z");t.fillStyle=H(c,"right","finger",s),t.fill(h),t.resetTransform(),t.translate((.9*a+.078)*e,(.05+.16)*n),t.scale(-i,i),t.fillStyle=H(c,"left","finger",s),t.fill(h),t.resetTransform()}}(n,i,o,a)}},e.overlay_spans=function(t,e,n,r){var i=n,o=this.cvsWidth,s=this.wave_vh,a=(0,T.Z)(r,2),c=a[0],$=a[1],l=function(t){return~~(t/i*o)},h=this.ctx;if(h){this.annot.clearSpanAreas();var u=[],_=!0,f=!1,v=void 0;try{for(var d,p=t[Symbol.iterator]();!(_=(d=p.next()).done);_=!0){var g=d.value;if(!(g.end<c)&&!(g.start>$)){var y=(g.start-c)*e,w=(g.end-c)*e,x={x:l(y),y:~~(-1*s/2)+(this.cvsHeight-s/2),width:l(w)-l(y),height:s};u.push(x),this.annot.cursorInBox(x)?(this.annot.setActiveSpan(g),h.strokeStyle="#F93F"):h.strokeStyle="#FD3F",h.lineWidth=3,h.strokeRect(x.x,x.y,x.width,x.height)}}}catch(S){f=!0,v=S}finally{try{_||null==p.return||p.return()}finally{if(f)throw v}}this.notifySpanAreas(u)}},e.overlay_pose=function(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],this.ctx){var e,n,r,i,o,s,a;e=this.ctx,n=t,r=this.cvsWidth,i=this.cvsHeight,o=function(t){var e,n,o;return e=t,n=r,o=i,e.length<2?e:[e[0]*n,e[1]*o]},s=function(t){e.strokeStyle="#EEE",e.fillStyle="#DA0",e.lineWidth=1;var n=!0,r=!1,i=void 0;try{for(var s,a=[[0,1,2,3,4],[0,5,6,7,8],[0,17,18,19,20],[5,9,13,17],[9,10,11,12],[13,14,15,19]][Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var c=s.value;e.beginPath();for(var $=0;$<c.length-1;$++){var l=o(t[c[$]]),h=o(t[c[$+1]]);0==$&&e.moveTo(l[0],l[1]),e.lineTo(h[0],h[1])}e.stroke()}}catch(u){r=!0,i=u}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}var _=!0,f=!1,v=void 0;try{for(var d,p=t[Symbol.iterator]();!(_=(d=p.next()).done);_=!0){var g=d.value;e.beginPath();var y=o(g);e.moveTo(y[0],y[1]),e.arc(y[0],y[1],2,0,360),e.fill()}}catch(w){f=!0,v=w}finally{try{_||null==p.return||p.return()}finally{if(f)throw v}}},a=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.strokeStyle="#FFF",e.lineWidth=1,e.beginPath();for(var r=0;r<t.length-1;r++){var i=o(t[r]),s=o(t[r+1]);0==r&&e.moveTo(i[0],i[1]),e.lineTo(s[0],s[1])}if(n){var a=o(t[0]);e.lineTo(a[0],a[1])}e.stroke()},n&&n.face&&(a(n.face.left_eye,!0),a(n.face.right_eye,!0),a(n.face.left_eyebrow_lower),a(n.face.right_eyebrow_lower),a(n.face.lip_inner,!0)),n&&n.pose&&function(t,n,r){e.strokeStyle="#EEE",e.fillStyle="#FD0",e.lineWidth=2;var i=[15,13,11,12,14,16].map(function(e){return[t[e][0],t[e][1]]});n&&(i[0]=[n[0][0],n[0][1]]),r&&(i[5]=[r[0][0],r[0][1]]),e.beginPath();for(var s=0;s<i.length-1;s++){var a=o(i[s]),c=o(i[s+1]);0==s&&e.moveTo(a[0],a[1]),e.lineTo(c[0],c[1])}e.stroke();var $=!0,l=!1,h=void 0;try{for(var u,_=i[Symbol.iterator]();!($=(u=_.next()).done);$=!0){var f=u.value;e.beginPath();var v=o(f);e.arc(v[0],v[1],3,0,360),e.fill()}}catch(d){l=!0,h=d}finally{try{$||null==_.return||_.return()}finally{if(l)throw h}}}(n.pose,n.left_hand,n.right_hand),n&&n.left_hand&&s(n.left_hand),n&&n.right_hand&&s(n.right_hand)}},t}(),O=n(5095),D=n(6560),q=n(8107);function z(t){var e=function(e){t.annotSpan&&(t.annotSpan.annotation=e.target.value,t.onUpdate(t.annotSpan))},n=function(){t.annotSpan&&t.onDelete(t.annotSpan)},r=t.annotSpan?t.annotSpan.annotation:"";return(0,s.jsxs)(O.ZP,{open:t.isOpen,anchorReference:"anchorPosition",anchorPosition:{top:t.top,left:t.left},onClose:t.onClose,anchorOrigin:{vertical:"top",horizontal:"left"},children:[(0,s.jsx)(D.Z,{label:"Annot",variant:"outlined",size:"small",value:r,onChange:e}),(0,s.jsx)(q.Z,{baseClassName:"fas",className:"fa-check icon-hover",color:"success",fontSize:"small",onClick:t.onClose}),(0,s.jsx)(q.Z,{baseClassName:"fas",className:"fa-trash icon-hover",color:"info",fontSize:"small",onClick:n})]})}var Z={canvasContainer:{width:"100%"},canvas:{backgroundColor:"gray",backgroundSize:"cover",backgroundPosition:"center center",backgroundRepeat:"no-repeat"},barContainer:{display:"flex",backgroundColor:"#F0F0F0",justifyContent:"space-between",position:"relative",top:"0px",width:"100%",height:"40px"},button:{height:"40px",border:"none",backgroundColor:"inherit",cursor:"pointer"},buttonIcon:{width:"20px",height:"20px",margin:"10px 10"},progress:{width:"calc(100% - 40px)",margin:"0 20px",height:"40px",cursor:"pointer"},progressVol:{width:"calc(30% - 40px)"},progressMuted:{backgroundColor:"rgba(0,0,0,0.5)"},time:{height:"40px",lineHeight:"40px",fontSize:"1rem",fontFamily:"Arial"}},N=n(7988),V=n(4405),B=function(){function t(e){(0,m.Z)(this,t),this.videoControl={},this.cursor={x:0,y:0,isPressed:!1},this._redrawCallback=function(){},this._onAnnotSpansUpdated=null,this._onActiveSpanChanged=null,this._waveArea={width:0,height:0,x:0,y:0},this._spanAreas=[],this._ocrAreas=[],this._selected_phone_range={},this._press_phone=null,this._span_data=[],this._annot_spans=[],this.videoControl=e}var e=t.prototype;return e.setAnnotationSpans=function(t){this._span_data=t,this._annot_spans=t.map(function(t){return(0,V.Z)((0,i.Z)({},t),{start:t.offset,end:t.offset+t.span,annotation:t.annotation,isActive:!1})})},e.isPhoneSelected=function(t){var e=this._selected_phone_range;return(!!e.start||!!e.end)&&e.start[0]<=t[0]&&t[0]<=e.end[0]},e.updateWaveArea=function(t){this._waveArea=t},e.updateSpanAreas=function(t){this._spanAreas=t},e.updateOcrAreas=function(t){this._ocrAreas=t},e.clearSpanAreas=function(){this._spanAreas=[]},e.setActiveSpan=function(t){1==this._annot_spans.reduce(function(t,e){return t+~~e.isActive},0)&&t.isActive||(this._annot_spans.forEach(function(t){return t.isActive=!1}),t.isActive=!0,this._redrawCallback())},e.onPhoneDetected=function(t){if(this.isPressed){var e=this._selected_phone_range,n=this._press_phone;e.start||e.end?n&&t[0]>n[0]?e.end=t:n&&t[0]<n[0]&&(e.start=t):(e.start=t,e.end=t,this._press_phone=t)}},e.onOcrDetected=function(t){if(this.isPressed){var e,n,r,i,o,s=(r=(~~((n=~~((e=t.offset/1e3)/60))/60)).toString().padStart(2,"0"),i=n.toString().padStart(2,"0"),o=(~~e%60).toString().padStart(2,"0"),"".concat(r,":").concat(i,":").concat(o)),a="[".concat(t.name,"] ").concat(s," ").concat(t.payload.text);(null==navigator?void 0:navigator.clipboard)&&(navigator.clipboard.writeText(a),console.log("Text copied: ",a))}},e.setRedrawCallback=function(t){this._redrawCallback=t},e.setActiveSpanChangedCallback=function(t){this._onActiveSpanChanged=t},e.setAnnotSpansUpdatedCallback=function(t){this._onAnnotSpansUpdated=t},e._pointInBox=function(t,e){return!!(t.x>e.x)&&!!(t.x<e.x+e.width)&&!!(t.y>e.y)&&!!(t.y<e.y+e.height)},e.cursorInBoxes=function(t,e){var n=this;return e.some(function(e){return n._pointInBox(t,e)})},e.cursorInBox=function(t){var e={x:this.cursor.x,y:this.cursor.y};return this._pointInBox(e,t)},e.onMouseMove=function(t){this.cursor={x:t.nativeEvent.offsetX,y:t.nativeEvent.offsetY,isPressed:this.cursor.isPressed},this._redrawCallback()},e.onMouseUp=function(t){var e=this;this.cursor.isPressed=!1,this._press_phone=null;var n=this._selected_phone_range;if(n.start&&n.end){var r=n.start,i=n.end,o={name:this.videoControl.videoName,offset:r[1],span:i[2]-r[1],start:r[1],end:i[2],videoMeta:{},text:"",annotation:"",isActive:!0};this._annot_spans.push(o)}this._onAnnotSpansUpdated&&this._onAnnotSpansUpdated(this._annot_spans);var s={x:t.nativeEvent.offsetX,y:t.nativeEvent.offsetY},a=this._ocrAreas.some(function(t){return e._pointInBox(s,t)});this._pointInBox(s,this._waveArea)||a?this._redrawCallback():this.videoControl.playPause()},e.onMouseDown=function(t){var e={x:t.nativeEvent.offsetX,y:t.nativeEvent.offsetY};if(this.cursorInBoxes(e,this._spanAreas)){if(this._onActiveSpanChanged){var n=this._annot_spans.filter(function(t){return t.isActive});if(1==n.length){var r=t.nativeEvent.clientX,i=t.nativeEvent.clientY;this._onActiveSpanChanged(n[0],[r,i])}}}else this._selected_phone_range={},this.cursor.isPressed=!0,this._redrawCallback()},e.onMouseLeave=function(t){this.cursor={x:0,y:0,isPressed:!1},this._redrawCallback()},e.onKeyUp=function(t){console.log(t)},(0,N.Z)(t,[{key:"isPressed",get:function(){return this.cursor.isPressed}},{key:"annotSpans",get:function(){return this._annot_spans}}]),t}(),G=function(){function t(){(0,m.Z)(this,t),this.video=null,this.videoStateSetter=function(t){},this.toggleWaveform=function(){},this.togglePosture=function(){}}var e=t.prototype;return e.setVideo=function(t,e){this.video=t,this.videoStateSetter=e.stateSetter,this.toggleWaveform=e.toggleWaveform,this.togglePosture=e.togglePosture},e.playPause=function(){this.video&&(this.video.paused?this.video.play():this.video.pause(),this.videoStateSetter(this.video))},e.seek=function(t){this.video&&(this.video.currentTime=t,this.videoStateSetter(this.video))},e.toggleMute=function(){this.video&&(this.video.muted=!this.video.muted,this.videoStateSetter(this.video))},e.changeVolume=function(t){this.video&&(this.video.volume=t,this.videoStateSetter(this.video))},(0,N.Z)(t,[{key:"videoName",get:function(){var t,e=null===(t=this.video)||void 0===t?void 0:t.src;if(!e)return"";var n=new URL(e).pathname.split("/");return n[n.length-1].replace(".mp4","")}}]),t}(),K=640/360,X=new G,Y=new B(X),J=new I(Y),Q=new j,tt=function(t){var e,n,r,c,$,l,h,u,_,f,v,d,p,g,y,w,S,m,P,A,T,E,b,C,L,W,M=function(){var e=N.current;if(!e||!V.current)return null;V.current;var n=e.getContext("2d");if(!n)return null;e.width=e.clientWidth,e.height=e.clientWidth/K,J.setContext(n,e.width,e.height),X.setVideo(V.current,te);var r=new URL(t.video_url).pathname.split("/");if(r.length>1){var i=r.at(r.length-1);(Q=new j).setVideoName(i),Q.loadData()}return{onPlayHandler:function(){requestAnimationFrame(t0)},onTimeUpdateHandler:function(){V.current&&te.stateSetter(V.current)},onResizeHandler:function(){var t=N.current;if(!t)return null;var e=t.getContext("2d");if(!e)return null;var n=t.clientWidth,r=t.clientWidth/K;J.setContext(e,n,r),requestAnimationFrame(t0)}}},H=function(t){Q.setWaveWindow(t),requestAnimationFrame(t0)},R=function(t){if("ArrowRight"==t.key){if(V.current){var e=1*Math.pow(10,Number(t.ctrlKey)-Number(t.altKey));X.seek(V.current.currentTime+e),t.stopPropagation(),t.preventDefault()}}else if(" "==t.key)X.playPause(),t.stopPropagation(),t.preventDefault();else if("ArrowLeft"==t.key&&V.current){var n=1*Math.pow(10,Number(t.ctrlKey)-Number(t.altKey));X.seek(V.current.currentTime-n),t.stopPropagation(),t.preventDefault()}},F=function(t,e){tv.setLocation(e[0],e[1]),tv.openWidget(t)},U=function(){tv.closeWidget()},I=function(t){var e=[],n=!0,r=!1,i=void 0;try{for(var o,s=q[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;a.name==t.name&&a.offset==t.offset?e.push(t):e.push(a)}}catch(c){r=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}tv.setAnnotSpan(t),D(e)},O=function(t){var e=[],n=!0,r=!1,i=void 0;try{for(var o,s=q[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;a.name==t.name&&a.offset==t.offset||e.push(a)}}catch(c){r=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}tv.closeWidget(),D(e)},D=function(e){var n=function(t){var e=[],n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value,c=Object.assign({},a);c.offset*=1e3,c.span*=1e3,e.push(c)}}catch($){r=!0,i=$}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return e}(e);t.onAnnotSpansUpdated(n),requestAnimationFrame(t0)},q=function(t){var e=[],n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value,c=Object.assign({},a);c.offset/=1e3,c.span/=1e3,e.push(c)}}catch($){r=!0,i=$}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return e}(t.annotSpans),N=(0,a.useRef)(null),V=(0,a.useRef)(null),B=(0,a.useRef)(0),G=(V.current,r=function(t){u(!t.paused),v(t.muted),g(t.currentTime),S(t.duration),A(t.volume)},c=function(){b(function(t){return!t})},$=function(){W(function(t){return!t})},h=(l=(0,a.useState)(!1))[0],u=l[1],f=(_=(0,a.useState)(!1))[0],v=_[1],p=(d=(0,a.useState)(0))[0],g=d[1],w=(y=(0,a.useState)(0))[0],S=y[1],P=(m=(0,a.useState)(100))[0],A=m[1],E=(T=(0,a.useState)(!0))[0],b=T[1],L=(C=(0,a.useState)(!1))[0],W=C[1],{videoState:{isPlaying:h,isMuted:f,currentTime:p,duration:w,volume:P,toShowWaveform:E,toShowPosture:L},stateSetter:r,toggleWaveform:c,togglePosture:$}),tt=G.videoState,te=(0,o.Z)(G,["videoState"]);X.setVideo(V.current,te);var tn,tr,ti,to,ts,ta,tc,t$,tl,th,tu,t_,tf=(0,a.useRef)({});tf.current.toShowOcr=!0,tf.current.toShowPosture=tt.toShowPosture,tf.current.toShowWave=tt.toShowWaveform;var tv=(tn=function(t){ta(!0),t_(t)},tr=function(){ta(!1)},ti=function(t,e){tl({x:t,y:e})},ts=(to=(0,a.useState)(!1))[0],ta=to[1],t$=(tc=(0,a.useState)({x:0,y:0}))[0],tl=tc[1],tu=(th=(0,a.useState)(null))[0],{isOpen:ts,loc:t$,annotSpan:tu,openWidget:tn,closeWidget:tr,setLocation:ti,setAnnotSpan:t_=th[1]});function t0(t){var e=V.current;if(e){var n=t-B.current;B.current=t;var r=tf.current.toShowWave,i=tf.current.toShowPosture;if(n>15){var o=Q.getData(e.currentTime,tt.toShowPosture),s=N.current;if(!s)return null;var a=s.clientWidth,c=s.clientWidth/K;s.width=a,s.height=c;var $=s.getContext("2d");if(!$)return null;$.drawImage(e,0,0,a,c),J.setContext($,a,c),J.setOptions({toShowOcr:!0,toShowWave:r,toShowPosture:i}),J.paint(o,~~(1/Math.max(n/1e3,.001)*100)/100)}e.paused||e.ended||requestAnimationFrame(t0)}}Y.setAnnotationSpans(q),Y.setAnnotSpansUpdatedCallback(D),(0,a.useEffect)(function(){if(""!==t.video_url){var e=M(),n=V.current;if(e&&n)return n.addEventListener("play",e.onPlayHandler,!1),n.addEventListener("canplay",e.onPlayHandler,!1),n.addEventListener("timeupdate",e.onTimeUpdateHandler,!1),window.addEventListener("resize",e.onResizeHandler,!1),window.addEventListener("keydown",R,!0),Y.setRedrawCallback(function(){return requestAnimationFrame(t0)}),Y.setActiveSpanChangedCallback(F),function(){n.removeEventListener("play",e.onPlayHandler,!1),n.removeEventListener("canplay",e.onPlayHandler,!1),n.removeEventListener("timeupdate",e.onTimeUpdateHandler,!1),window.removeEventListener("resize",e.onResizeHandler,!1),window.removeEventListener("keydown",R,!0)}}},[t.video_url]),(0,a.useEffect)(function(){var e=V.current;e&&(e.currentTime=t.seekToSec||0)},[t.seekToSec]),(0,a.useEffect)(function(){if(!t.seekToSec){var e=V.current;e&&(e.currentTime=k(t.seekToTimeStr))}},[t.seekToTimeStr]);var td={};return Object.keys(Z).forEach(function(t){td[t]=(0,i.Z)({},Z[t])}),e=tv.annotSpan?(0,s.jsx)(z,{isOpen:tv.isOpen,left:tv.loc.x,top:tv.loc.y,annotSpan:tv.annotSpan,onDelete:O,onUpdate:I,onClose:U}):(0,s.jsx)("div",{}),V.current&&requestAnimationFrame(t0),(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[e,(0,s.jsx)("video",{ref:V,src:t.video_url,style:{display:"none"}}),(0,s.jsx)("canvas",{ref:N,style:(0,i.Z)({width:"100%"},td.canvas),onMouseMove:Y.onMouseMove.bind(Y),onMouseUp:Y.onMouseUp.bind(Y),onMouseDown:Y.onMouseDown.bind(Y),onMouseLeave:Y.onMouseLeave.bind(Y)}),(0,s.jsx)(x,{styles:td,videoState:tt,videoCtrl:X,annotSpans:q,onWinSizeChanged:H})]})}}}]);