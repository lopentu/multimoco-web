"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[174],{2174:function(e,n,t){t.d(n,{Z:function(){return es}});var r,s=t(9072),a=t(9970),l=t(1527),i=t(959),c=t(711),o=t(8253),$=t(9119),u=t(8711),d=t.n(u),p=t(5484),h=t(1530),x=t(4066),g=t(3749),j=t(9929),f=function(e){var n={};return Object.keys(e).forEach(function(t){var r=e[t];"object"!=typeof r||null===r||Array.isArray(r)?n[t]=r:Object.assign(n,f(r))}),n},m=t(2834),Z=t(6812),v=t(9114),_=t(6697),y=t(6607),S=t(3862),T=t(4502),P=t(769),C=t(4617),b=t(5059),k=t(5028),L=t(9181),I=t(7343),A=t(9121),M=t(9668),E=t(2325),w=t(5975);function F(e){var n=(0,C.Z)(),t=e.count,r=e.page,s=e.rowsPerPage,a=e.onPageChange,i=function(e){a(e,0)},c=function(e){a(e,r-1)},o=function(e){a(e,r+1)},$=function(e){a(e,Math.max(0,Math.ceil(t/s)-1))};return(0,l.jsxs)(y.Z,{sx:{flexShrink:0,ml:2.5},children:[(0,l.jsx)(S.Z,{onClick:i,disabled:0===r,"aria-label":"first page",children:"rtl"===n.direction?(0,l.jsx)(_.Z,{}):(0,l.jsx)(m.Z,{})}),(0,l.jsx)(S.Z,{onClick:c,disabled:0===r,"aria-label":"previous page",children:"rtl"===n.direction?(0,l.jsx)(v.Z,{}):(0,l.jsx)(Z.Z,{})}),(0,l.jsx)(S.Z,{onClick:o,disabled:r>=Math.ceil(t/s)-1,"aria-label":"next page",children:"rtl"===n.direction?(0,l.jsx)(Z.Z,{}):(0,l.jsx)(v.Z,{})}),(0,l.jsx)(S.Z,{onClick:$,disabled:r>=Math.ceil(t/s)-1,"aria-label":"last page",children:"rtl"===n.direction?(0,l.jsx)(m.Z,{}):(0,l.jsx)(_.Z,{})})]})}function U(e){var n=e.annotationSpans,t=(e.searchType,e.onSelectedSpanChanged),r=(0,s.Z)(i.useState(0),2),c=r[0],$=r[1],u=(0,s.Z)(i.useState(10),2),d=u[0],p=u[1],h=Array.from(n.reduce(function(e,n){return e.set(n.name,(0,a.Z)(e.get(n.name)||[]).concat([n]))},new Map).values()),x=c>0?Math.max(0,(1+c)*d-h.length):0,g=function(e,n){$(n)},j=function(e){p(parseInt(e.target.value,10)),$(0)};return(0,l.jsx)(I.Z,{component:P.Z,children:(0,l.jsxs)(b.Z,{sx:{minWidth:500},"aria-label":"custom pagination table",size:"small",children:[(0,l.jsx)(M.Z,{children:(0,l.jsxs)(w.Z,{children:[(0,l.jsx)(L.Z,{align:"left",children:"Info"}),(0,l.jsx)(L.Z,{align:"left",children:"Text"})]})}),(0,l.jsxs)(k.Z,{children:[(d>0?h.slice(c*d,c*d+d):h).map(function(e,n,r){return e.map(function(n,r,a){var i,c,$,u,d,p,h,x;return(0,l.jsxs)(w.Z,{children:[0===r&&(0,l.jsx)(L.Z,{sx:{width:200},component:"th",scope:"row",rowSpan:e.length,children:("news"===(i=n).video_type?c={channel:"Channel",datetime:"Date"}:"legvid"===i.video_type&&(c={channel:"Channel",datetime:"Date",legislator:"Legislator",meeting_committee:"Meeting Committee"}),(0,l.jsxs)(l.Fragment,{children:[Object.entries(c).map(function(e){var n=(0,s.Z)(e,2),t=n[0],r=n[1];return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Z,{variant:"overline",display:"block",children:r}),(0,l.jsx)(o.Z,{variant:"button",display:"block",children:(0,l.jsx)("strong",{children:i[t]})})]})}),(0,l.jsx)(o.Z,{variant:"overline",display:"block",children:"Name"}),(0,l.jsx)(o.Z,{variant:"button",display:"block",children:i.name})]}))}),(0,l.jsxs)(L.Z,{align:"left",children:[(0,l.jsxs)(T.Z,{color:"primary",onClick:function(){t("https://storage.googleapis.com/multimoco/selected/h264/".concat(n.name,".mp4"),n.offset/1e3)},children:["[",(d=~~((u=($=n.offset)/1e3)/3600),p=~~(u%3600/60),h=~~u%60,x="",d>0&&(x+=""+d+":"+(p<10?"0":"")),x+=""+p+":"+(h<10?"0":""),x+=""+h),"]"]}),"\xa0",n.annotation?"<".concat(n.annotation,">").concat(n.text):n.text]})]},"".concat((Math.random()+1).toString(36).substring(8)))})}),x>0&&(0,l.jsx)(w.Z,{style:{height:53*x},children:(0,l.jsx)(L.Z,{colSpan:6})})]}),(0,l.jsx)(A.Z,{children:(0,l.jsx)(w.Z,{children:(0,l.jsx)(E.Z,{rowsPerPageOptions:[5,10,25,{label:"All",value:-1}],colSpan:3,count:h.length,rowsPerPage:d,page:c,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},onPageChange:g,onRowsPerPageChange:j,ActionsComponent:F})})})]})})}function H(e){var n=function(e,n,t){var r=new Blob([e],{type:t}),s=URL.createObjectURL(r),a=document.createElement("a");a.href=s,a.setAttribute("download",n),a.click()},t=function(e){var n=e.map(f),t=["clip_lowres_link","clip_highres_link","video_id","filename"],r=Array.from(new Set(n.map(function(e){return Object.keys(e)}).flat())).concat(["query_text","search_type","gesture_speaker","collection","gesture_select"]);console.log("H",r);var s=r.filter(function(e){return!t.includes(e)});console.log(s);var a=n.map(function(e){var n=[];return e.query_text=i,e.search_type=c,e.gesture_speaker=d,e.collection=v,e.gesture_select=m,s.forEach(function(t){return e[t]?n.push(String(e[t]).replace(/(.*)/,'"$1"')):n.push("na")}),n.join(",")});return console.log("To be saved:"),console.log(a.slice(0,5)),"\uFEFF"+s.join(",")+"\n"+a.join("\n")},r=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",t=e.slice(0,e.indexOf("\n")).split(n).map(function(e){return e.trim()}),r=e.slice(e.indexOf("\n")+1).split(/\r?\n|\r|\n/),s=["offset","span","duration","start","end"],a=["gesture_select","cosp"],l=r.map(function(e){var r=e.split(n);return t.reduce(function(e,n,t){var l=r[t];return"na"!==l?(s.includes(n)&&(l=Number(l)),a.includes(n)&&(l=l.split(","))):l="",e[n]=l,e},{})});return o(l[0].query_text),$(l[0].search_type),_(l[0].collection),Z(l[0].gesture_select),p(l[0].gesture_speaker),console.log(l),l},s=e.annotationSpans,a=e.setAnnotationSpans,i=e.queryText,c=e.searchType,o=e.setQueryText,$=e.setSearchType,u=e.onSelectedSpanChanged,d=e.speaker,p=e.setSpeaker,m=e.cosp,Z=e.setCosp,v=e.searchCollection,_=e.setSearchCollection;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fs-2 text-muted",children:"Search Results"}),(0,l.jsxs)(j.Z,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,l.jsx)(g.Z,{onClick:function(){return n(t(s),"multimoco-".concat(i,"-").concat(c,".csv"),"text/csv;charset=UTF-8;")},startIcon:(0,l.jsx)(h.Z,{color:"primary",fontSize:"large"}),children:"Download"}),(0,l.jsxs)(g.Z,{startIcon:(0,l.jsx)(x.Z,{color:"primary",fontSize:"large"}),component:"label",children:["Upload",(0,l.jsx)("input",{onChange:function(e){var n=new FileReader;n.onload=function(e){var n,t=null===(n=e.target)||void 0===n?void 0:n.result,s=r(t);console.log(s),a(s)},n.readAsText(e.target.files[0]),e.target.value=""},hidden:!0,type:"file",id:"csvFile",accept:".csv"})]})]}),(0,l.jsx)(U,{annotationSpans:s,searchType:c,onSelectedSpanChanged:u})]})}function R(e){try{var n=new URL(e).pathname.split("/");return n[n.length-1].replace(".mp4","")}catch(t){return""}}var O,N=t(5596),D=t(3888),G=t(6560),W=t(4878),q=t(1989),z=t(3141),Q=t(123),B=t(9974),X=t(9011),V=t(1032),J=t(8357),K=t(9335),Y=t(9995);(O=r||(r={}))[O.LOS_DOWN=1]="LOS_DOWN",O[O.LOS_LEFT=2]="LOS_LEFT",O[O.LOS_RIGHT=3]="LOS_RIGHT",O[O.LEFT_PALM_IN=4]="LEFT_PALM_IN",O[O.LEFT_PALM_OUT=5]="LEFT_PALM_OUT",O[O.LEFT_PALM_UP=6]="LEFT_PALM_UP",O[O.LEFT_PALM_DOWN=7]="LEFT_PALM_DOWN",O[O.LEFT_PALM_MEDIAL=8]="LEFT_PALM_MEDIAL",O[O.LEFT_THUMB_UP=9]="LEFT_THUMB_UP",O[O.LEFT_INDEX_UP=10]="LEFT_INDEX_UP",O[O.RIGHT_PALM_IN=11]="RIGHT_PALM_IN",O[O.RIGHT_PALM_OUT=12]="RIGHT_PALM_OUT",O[O.RIGHT_PALM_UP=13]="RIGHT_PALM_UP",O[O.RIGHT_PALM_DOWN=14]="RIGHT_PALM_DOWN",O[O.RIGHT_PALM_MEDIAL=15]="RIGHT_PALM_MEDIAL",O[O.RIGHT_THUMB_UP=16]="RIGHT_THUMB_UP",O[O.RIGHT_INDEX_UP=17]="RIGHT_INDEX_UP";var ee={PaperProps:{style:{padding:0,minWidth:100}}};function en(e){var n=function(n){var t=n.target.value;e.setCosp("string"==typeof t?t.split(","):t)};return(0,l.jsx)("div",{children:(0,l.jsxs)(j.Z,{direction:{xs:"row"},spacing:1,children:[(0,l.jsxs)(W.Z,{sx:{minWidth:150},size:"small",children:[(0,l.jsx)(X.Z,{id:"gesture-multiple-checkbox-label",children:"Gesture"}),(0,l.jsx)(V.Z,{labelId:"gesture-multiple-checkbox-label",id:"gesture-multiple-checkbox",multiple:!0,value:e.cosp,label:"Gesture",onChange:n,renderValue:function(e){return e.join(", ")},MenuProps:ee,name:"gestureSelect",autoWidth:!0,children:Object.keys(r).filter(function(e){return isNaN(Number(e))}).map(function(n){return(0,l.jsxs)(J.Z,{value:n,children:[(0,l.jsx)(Y.Z,{checked:e.cosp.indexOf(n)>-1}),(0,l.jsx)(K.Z,{primary:n})]},n)})})]}),(0,l.jsxs)(W.Z,{sx:{minWidth:150},size:"small",children:[(0,l.jsx)(X.Z,{id:"speaker-select-small",children:"Speaker"}),(0,l.jsxs)(V.Z,{labelId:"speaker-select-small",id:"speaker-select-small",value:e.speaker,label:"Speaker",onChange:function(n){return e.setSpeaker(n.target.value)},MenuProps:ee,name:"gestureSpeaker",children:[(0,l.jsx)(J.Z,{value:"any",children:"Any"}),(0,l.jsx)(J.Z,{value:"SP1",children:"Speaker 1"}),(0,l.jsx)(J.Z,{value:"SP2",children:"Speaker 2"})]})]})]})})}var et={PaperProps:{style:{maxHeight:275,padding:0,minWidth:100}}};function er(e){return(0,l.jsx)($.Z,{container:!0,spacing:1,children:(0,l.jsx)($.Z,{xs:12,children:(0,l.jsxs)("form",{action:"search",method:"GET",children:[(0,l.jsx)($.Z,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:(0,l.jsx)($.Z,{xs:12,children:(0,l.jsx)(G.Z,{fullWidth:!0,label:"Query Text",id:"search",type:"text",name:"query",value:e.queryText,onChange:function(n){return e.setQueryText(n.target.value)},InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,l.jsx)(g.Z,{type:"submit",variant:"contained",disableElevation:!0,children:(0,l.jsx)(D.Z,{})})},required:!0})})}),(0,l.jsxs)($.Z,{container:!0,spacing:{xs:0,sm:1},justifyContent:"left",alignItems:"center",children:[(0,l.jsx)($.Z,{xs:"auto",display:"flex",sx:{flexDirection:"row"},children:(0,l.jsxs)(W.Z,{children:[(0,l.jsx)(q.Z,{id:"demo-radio-buttons-group-label",children:"Search Type"}),(0,l.jsxs)(z.Z,{row:!0,"aria-labelledby":"demo-radio-buttons-group-label",value:e.searchType,onChange:function(n){return e.setSearchType(n.target.value)},name:"searchType",children:[(0,l.jsx)(Q.Z,{value:"asr",control:(0,l.jsx)(B.Z,{}),label:"ASR"}),(0,l.jsx)(Q.Z,{value:"ocr",control:(0,l.jsx)(B.Z,{}),label:"OCR"})]})]})}),(0,l.jsx)($.Z,{xs:"auto",children:(0,l.jsxs)(W.Z,{sx:{width:150},size:"small",children:[(0,l.jsx)(X.Z,{id:"search-collection-label",children:"Collection"}),(0,l.jsxs)(V.Z,{labelId:"search-collection-label",id:"collection-select",value:e.searchCollection,label:"Collection",name:"searchCollection",onChange:function(n){return e.setSearchCollection(n.target.value)},MenuProps:et,children:[(0,l.jsx)(J.Z,{value:"legvid",children:"Legislature"}),(0,l.jsx)(J.Z,{value:"news",children:"News"}),(0,l.jsx)(J.Z,{value:"all",children:"All"})]})]})}),(0,l.jsx)($.Z,{xs:"auto",children:(0,l.jsx)(en,{cosp:e.cosp,setCosp:e.setCosp,speaker:e.speaker,setSpeaker:e.setSpeaker})})]})]})})})}var es=function(e){var n=function(e,n){k(e),A(n)},t=function(e){var n,t=R(b),r=E.findIndex(function(e){return e.name==t}),s=E;r>=0&&(s=E.filter(function(e){return e.name!=t}),console.log("selected Spans: ",s),(n=s).splice.apply(n,[r,0].concat((0,a.Z)(e)))),console.log("newSpans: ",s),w(s)},r=(0,i.useState)(""),u=r[0],h=r[1],x=(0,i.useState)(""),g=x[0],j=x[1],f=(0,i.useState)("legvid"),m=f[0],Z=f[1],v=(0,s.Z)(i.useState([]),2),_=v[0],y=v[1],S=(0,s.Z)(i.useState("any"),2),T=S[0],P=S[1],C=(0,i.useState)(""),b=C[0],k=C[1],L=(0,i.useState)(0),I=L[0],A=L[1],M=(0,i.useState)(JSON.parse(e.searchResults)),E=M[0],w=M[1],F=null!==E?E.filter(function(e){return e.name==R(b)}):null,U=(0,p.useRouter)().query;return(0,i.useEffect)(function(){Array.isArray(U.query)?h(U.query.at(0)||""):h(U.query||""),void 0!==U.searchType?j(U.searchType):j("asr"),void 0!==U.searchCollection?Z(U.searchCollection):Z("legvid"),void 0!==U.searchCollection?Z(U.searchCollection):Z("legvid"),void 0!==U.gestureSelect?y(U.gestureSelect.split(",")):y([]),void 0!==U.gestureSpeaker?P(U.gestureSpeaker):P("any")},[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(d(),{children:[(0,l.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,l.jsx)("title",{children:"MultiMoco NTU\xa0|\xa0台大多媒體語料庫"})]}),(0,l.jsx)("section",{className:"features-1",style:{minHeight:"100vh"},children:(0,l.jsxs)(c.Z,{maxWidth:"xl",children:[(0,l.jsxs)($.Z,{display:"flex",container:!0,spacing:2,sx:{flexDirection:"row"},children:[(0,l.jsx)(er,{queryText:u,setQueryText:h,searchType:g,setSearchType:j,searchCollection:m,setSearchCollection:Z,cosp:_,setCosp:y,speaker:T,setSpeaker:P}),E?(0,l.jsx)($.Z,{xs:6,md:6,lg:5,display:"flex",justifyContent:"center",alignContent:"center",sx:{position:"fixed",right:"10px"},children:b&&F&&(0,l.jsx)(N.Z,{video_url:b,seekToSec:I,annotSpans:F,onAnnotSpansUpdated:t})}):(0,l.jsx)("div",{})]}),(0,l.jsx)($.Z,{container:!0,spacing:5,children:E?(0,l.jsx)($.Z,{xs:12,children:(0,l.jsx)(H,{annotationSpans:E,setAnnotationSpans:w,queryText:u,searchType:g,searchCollection:m,speaker:T,cosp:_,setQueryText:h,setSearchType:j,setCosp:y,setSearchCollection:Z,onSelectedSpanChanged:n,setSpeaker:P})}):(0,l.jsx)($.Z,{xs:12,display:"flex",justifyContent:"center",children:(0,l.jsx)(o.Z,{variant:"h5",children:"Query cannot be empty"})})})]})})]})}}}]);